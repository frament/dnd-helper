<div class="bg-gray-800 rounded-lg p-6 h-full flex flex-col overflow-auto">
  <!-- Заголовок и кнопки действий -->
  <div class="flex justify-between items-center mb-6 gap-6">
    <!-- Редактор названия -->
    <div class="flex-1">
      <label class="block text-gray-400 mb-2">Название карты</label>
      <input pInputText [(ngModel)]="_title"
             class="w-full text-xl font-bold"
             placeholder="Введите название карты...">
    </div>
    <!--<div class="flex space-x-2">
      <button pButton
              class="p-button-info"
              (click)="exportMap()">
        <i class="pi pi-download" pButtonIcon></i>
        <span pButtonLabel>Экспорт</span>
      </button>
    </div>-->
  </div>



  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Левая колонка: Основная информация -->
    <div class="lg:col-span-1">
      <div class="bg-gray-900 p-5 rounded-xl mb-6">
        <h4 class="text-lg font-semibold text-white mb-4">Основные параметры</h4>

        <!-- Тип карты -->
        <div class="mb-4">
          <label class="block text-gray-400 mb-2">Тип карты</label>
          <p-select [options]="mapTypes"
                      [(ngModel)]="_type"
                      placeholder="Выберите тип карты"
                      class="w-full"></p-select>
        </div>

        <!-- Размеры -->
        <div class="grid grid-cols-2 gap-4 mb-4">
          <div>
            <label class="block text-gray-400 mb-2">Ширина (м)</label>
            <p-inputNumber [(ngModel)]="_width"
                           [showButtons]="true"
                           [min]="10"
                           [max]="10000"
                           class="w-full"></p-inputNumber>
          </div>
          <div>
            <label class="block text-gray-400 mb-2">Высота (м)</label>
            <p-inputNumber [(ngModel)]="_height"
                           [showButtons]="true"
                           [min]="10"
                           [max]="10000"
                           class="w-full"></p-inputNumber>
          </div>
        </div>

        <!-- Теги -->
        <div class="mb-4">
          <label class="block text-gray-400 mb-2">Теги карты</label>
          <p-autoComplete [(ngModel)]="_tags"
                          multiple fluid
                   placeholder="Добавьте теги..."
                   class="w-full"></p-autoComplete>
        </div>

        <!-- Описание -->
        <div>
          <label class="block text-gray-400 mb-2">Описание</label>
          <textarea pInputTextarea [(ngModel)]="_description"
                    [rows]="3"
                    class="w-full"
                    placeholder="Добавьте описание карты..."></textarea>
        </div>
      </div>

      <!-- Слои карты -->
      <div class="bg-gray-900 p-5 rounded-xl">
        <h4 class="text-lg font-semibold text-white mb-4">Управление слоями</h4>

        <p-listbox [options]="layers"
                   [(ngModel)]="selectedLayer"
                   optionLabel="name"
                   [style]="{'width': '100%'}">
          <ng-template let-item pTemplate="item">
            <div class="flex items-center">
              <i [class]="'pi mr-3 ' + item.icon"></i>
              <span>{{item.name}}</span>
              <p-toggleswitch [ngModel]="item.visible" (ngModelChange)="item.visible = $event"
                             class="ml-auto"></p-toggleswitch>
            </div>
          </ng-template>
        </p-listbox>

        <div class="flex space-x-2 mt-3">
          <button pButton
                  class="p-button-text p-button-sm">
            <i class="pi pi-plus" pButtonIcon></i>
            <span pButtonLabel>Добавить слой</span>
          </button>
          <button pButton
                  class="p-button-text p-button-sm p-button-danger"
                  [disabled]="!selectedLayer">
            <i class="pi pi-trash" pButtonIcon></i>
            <span pButtonLabel>Удалить</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Центральная колонка: Изображение карты -->
    <div class="lg:col-span-2">
      <div class="bg-gray-900 p-5 rounded-xl h-full flex flex-col">
        <h4 class="text-lg font-semibold text-white mb-4">Изображение карты</h4>

        <!-- Область загрузки и предпросмотра -->
        <div class="flex-1 flex flex-col items-center justify-center relative border-2 border-dashed border-gray-600 rounded-xl"
             (dragover)="onDragOver($event)"
             (drop)="onDrop($event)"
             (click)="fileInput.click()">

          <!-- Предпросмотр карты -->
          @if (_file()) {
            <img [src]="_file()"
                 alt="Карта"
                 class="max-h-[500px] max-w-full object-contain">
          } @else {
            <div class="text-center p-8">
              <i class="pi pi-cloud-upload text-5xl text-gray-500 mb-4"></i>
              <p class="text-xl text-gray-400">Перетащите изображение сюда</p>
              <p class="text-gray-500 mt-2">или нажмите для выбора файла</p>
              <p class="text-sm text-gray-500 mt-4">Поддерживаемые форматы: JPG, PNG, WebP<br>Максимальный размер: 10MB</p>
            </div>
          }

          <!-- Индикатор загрузки -->
          @if (uploading()) {
            <div class="absolute inset-0 bg-gray-900 bg-opacity-80 flex items-center justify-center">
              <p-progressSpinner strokeWidth="4"
                                 animationDuration=".5s"></p-progressSpinner>
              <span class="ml-4 text-gray-300">Загрузка... {{uploadProgress()}}%</span>
            </div>
          }

          <!-- Скрытый input для загрузки файлов -->
          <input #fileInput type="file" accept="image/*"
                 class="hidden"
                 (change)="onFileSelected($event)">
        </div>

        <!-- Кнопки управления изображением -->
        <div class="flex flex-wrap justify-center gap-3 mt-6">
          <!-- Загрузка изображения -->
          <button pButton
                  class="p-button-success"
                  (click)="fileInput.click()">
            <i class="pi pi-upload" pButtonIcon></i>
            <span pButtonLabel>Загрузить</span>
          </button>

          <!-- Выбрать из библиотеки -->
          <button pButton
                  class="p-button-secondary"
                  (click)="openImageLibrary()">
            <i class="pi pi-images" pButtonIcon></i>
            <span pButtonLabel>Библиотека</span>
          </button>

          <!-- Удалить изображение -->
          @if (_file()) {
            <button pButton
                    class="p-button-danger"
                    (click)="removeImage()">
              <i class="pi pi-trash" pButtonIcon></i>
              <span pButtonLabel>Удалить</span>
            </button>
          }
        </div>

        <!-- Инструменты редактирования -->
        <div class="mt-6">
          <h5 class="text-gray-400 mb-3">Инструменты</h5>
          <div class="flex flex-wrap gap-2">
            <button pButton
                    class="p-button-outlined p-button-help"
                    [pTooltip]="'Рисование'">
              <i class="pi pi-pencil" pButtonIcon></i>
            </button>
            <button pButton
                    class="p-button-outlined p-button-help"
                    [pTooltip]="'Добавить метку'">
              <i class="pi pi-tag" pButtonIcon></i>
            </button>
            <button pButton
                    class="p-button-outlined p-button-help"
                    [pTooltip]="'Измерить расстояние'">
              <i class="pi pi-ruler" pButtonIcon></i>
            </button>
            <button pButton
                    class="p-button-outlined p-button-help"
                    [pTooltip]="'Увеличить'">
              <i class="pi pi-search-plus" pButtonIcon></i>
            </button>
            <button pButton
                    class="p-button-outlined p-button-help"
                    [pTooltip]="'Уменьшить'">
              <i class="pi pi-search-minus" pButtonIcon></i>
            </button>
            <button pButton
                    class="p-button-outlined p-button-help"
                    [pTooltip]="'Заблокировать перемещение'">
              <i class="pi pi-lock" pButtonIcon></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
