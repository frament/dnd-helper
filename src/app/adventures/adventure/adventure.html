<div class="flex h-full bg-gray-900">
  <!-- Левая панель навигации -->
  <div class="w-72 bg-gray-800 border-r border-gray-700 flex flex-col">
    <!-- Заголовок редактора -->
    <div class="p-4 border-b border-gray-700">
      <h2 class="text-xl font-bold text-white">Редактор приключения</h2>
      <p class="text-gray-400 text-sm">"{{ adventure.value()?.name }}"</p>
    </div>

    <!-- Навигационное меню -->
    <div class="flex-1 overflow-y-auto p-2">
      <p-accordion [value]="['0']" [multiple]="true">
        <!-- Заметки -->
        <p-accordion-panel value="0">
          <p-accordion-header>Заметки</p-accordion-header>
          <p-accordion-content>
          <div>
            @for (note of notes.value(); track note.id) {
              <div class="flex items-center justify-between py-2 px-3 rounded hover:bg-gray-700 cursor-pointer"
                   [class.bg-blue-900]="activeItem === note.id.id"
                   (click)="selectItem('notes', note.id.id+'')">
                <div class="flex items-center">
                  <i class="pi pi-file text-gray-400 mr-2"></i>
                  <span class="text-gray-300">{{note.title}}</span>
                </div>
                <button pButton
                        class="p-button-text p-button-sm p-button-plain"
                        (click)="openContextMenu($event, note)">
                  <i class="pi pi-ellipsis-v text-gray-400"></i>
                </button>
              </div>
            }
            <button pButton
                    class="p-button-text p-button-sm w-full mt-2"
                    (click)="addItem('notes')">
              <i class="pi pi-plus" pButtonIcon></i>
              <span pButtonLabel>Добавить заметку</span>
            </button>
          </div>
          </p-accordion-content>
        </p-accordion-panel>

        <!-- Карты -->
        <p-accordion-panel value="1">
          <p-accordion-header>Карты</p-accordion-header>
          <p-accordion-content>
          <div>
            @for (map of maps.value(); track map.id){
              <div class="flex items-center justify-between py-2 px-3 rounded hover:bg-gray-700 cursor-pointer"
                   [class.bg-blue-900]="activeItem === map.id.id"
                   (click)="selectItem('maps', map.id.id+'')">
                <div class="flex items-center">
                  <i class="pi pi-map text-gray-400 mr-2"></i>
                  <span class="text-gray-300">{{map.title}}</span>
                </div>
                <button pButton
                        class="p-button-text p-button-sm p-button-plain"
                        (click)="openContextMenu($event, map)">
                  <i class="pi pi-ellipsis-v" pButtonIcon></i>
                </button>
              </div>
            }
            <button pButton
                    class="p-button-text p-button-sm w-full mt-2"
                    (click)="addItem('maps')">
              <i class="pi pi-plus" pButtonIcon></i>
              <span pButtonLabel>Добавить карту</span>
            </button>
          </div>
          </p-accordion-content>
        </p-accordion-panel>

        <!-- Главы -->
        <p-accordion-panel value="2">
          <p-accordion-header>Главы</p-accordion-header>
          <p-accordion-content>
          <div>
            @for (chapter of chapters.value(); track chapter.id){
              <div class="flex items-center justify-between py-2 px-3 rounded hover:bg-gray-700 cursor-pointer"
                   [class.bg-blue-900]="activeItem === chapter.id.id"
                   (click)="selectItem('chapters', chapter.id.id+'')">
                <div class="flex items-center">
                  <i class="pi pi-book text-gray-400 mr-2"></i>
                  <span class="text-gray-300">{{chapter.title}}</span>
                </div>
                <button pButton
                        class="p-button-text p-button-sm p-button-plain"
                        (click)="openContextMenu($event, chapter)">
                  <i class="pi pi-ellipsis-v" pButtonIcon></i>
                </button>
              </div>
            }
            <button pButton
                    class="p-button-text p-button-sm w-full mt-2"
                    (click)="addItem('chapters')">
              <i class="pi pi-plus" pButtonIcon></i>
              <span pButtonLabel>Добавить главу</span>
            </button>
          </div>
          </p-accordion-content>
        </p-accordion-panel>

        <!-- NPC -->
        <p-accordion-panel value="3">
          <p-accordion-header>NPC</p-accordion-header>
          <p-accordion-content>
          <div>
            @for (npc of npcs.value(); track npc.id){
              <div class="flex items-center justify-between py-2 px-3 rounded hover:bg-gray-700 cursor-pointer"
                   [class.bg-blue-900]="activeItem === npc.id.id"
                   (click)="selectItem('npcs', npc.id.id+'')">
                <div class="flex items-center">
                  <i class="pi pi-user text-gray-400 mr-2"></i>
                  <span class="text-gray-300">{{npc.name}}</span>
                </div>
                <button pButton
                        class="p-button-text p-button-sm p-button-plain"
                        (click)="openContextMenu($event, npc)">
                  <i class="pi pi-ellipsis-v" pButtonIcon></i>
                </button>
              </div>
            }
            <button pButton
                    class="p-button-text p-button-sm w-full mt-2"
                    (click)="addItem('npcs')">
              <i class="pi pi-plus" pButtonIcon></i>
              <span pButtonLabel>Добавить NPC</span>
            </button>
          </div>
          </p-accordion-content>
        </p-accordion-panel>

        <!-- Артефакты -->
        <p-accordion-panel value="5">
          <p-accordion-header>Артефакты</p-accordion-header>
          <p-accordion-content>
          <div>
            @for (artifact of artifacts.value(); track artifact.id){
              <div class="flex items-center justify-between py-2 px-3 rounded hover:bg-gray-700 cursor-pointer"
                   [class.bg-blue-900]="activeItem === artifact.id.id"
                   (click)="selectItem('artifacts', artifact.id.id+'')">
                <div class="flex items-center">
                  <i class="pi pi-star text-gray-400 mr-2"></i>
                  <span class="text-gray-300">{{artifact.name}}</span>
                </div>
                <button pButton
                        class="p-button-text p-button-sm p-button-plain"
                        (click)="openContextMenu($event, artifact)">
                  <i class="pi pi-ellipsis-v" pButtonIcon></i>
                </button>
              </div>
            }
            <button pButton
                    class="p-button-text p-button-sm w-full mt-2"
                    (click)="addItem('artifacts')">
              <i class="pi pi-plus" pButtonIcon></i>
              <span pButtonLabel>Добавить артефакт</span>
            </button>
          </div>
          </p-accordion-content>
        </p-accordion-panel>
      </p-accordion>
    </div>

    <!-- Кнопки действий -->
    <div class="p-4 border-t border-gray-700">
      <button pButton class="p-button-secondary w-full mb-2"
              (click)="selectItem('events', '')">
        <i class="pi pi-history" pButtonIcon></i>
        <span pButtonLabel>Timeline</span>
      </button>
      <!--<button pButton class="p-button-success w-full mb-2">
        <i class="pi pi-save" pButtonIcon></i>
        <span pButtonLabel>Сохранить</span>
      </button>
      <button pButton class="p-button-secondary w-full">
        <i class="pi pi-eye" pButtonIcon></i>
        <span pButtonLabel>Предпросмотр</span>
      </button>-->
    </div>
  </div>

  <!-- Основная рабочая область -->
  <div class="flex-1 flex flex-col overflow-hidden">
    @if (activeType() !== 'events'){
      <!-- Заголовок рабочей области -->
      <div class="px-6 py-4 flex items-center justify-between">
        <h2 class="text-xl font-semibold text-white">
          {{activeItemTitle()}}
        </h2>
        <div class="flex space-x-2">
          <button pButton class="p-button-success"
                  [disabled]="!activeContentPatch()"
                  (click)="applyPatch()">
            <i class="pi pi-save" pButtonIcon></i>
            <span pButtonLabel>Сохранить</span>
          </button>
          <button pButton class="p-button-secondary"
                  [disabled]="!activeContentPatch()"
                  (click)="cancelPatch()">
            <i class="pi pi-times" pButtonIcon></i>
            <span pButtonLabel>Отменить</span>
          </button>
          <button pButton class="p-button-info"
                  [disabled]="activeContentPatch()"
                  (click)="exportItem()">
            <i class="pi pi-download" pButtonIcon></i>
            <span pButtonLabel>Экспорт</span>
          </button>
          <p-divider layout="vertical" />
          <button pButton class="p-button-danger mr-2">
            <i class="pi pi-trash" pButtonIcon></i>
          </button>
        </div>
      </div>
    }

    <!-- Контентная область -->
    <div class="flex-1 overflow-auto px-6 pb-6 bg-gray-900">
      <!-- Динамический контент -->
      @switch (activeType()){
        @case ('notes') {
          <!-- Заметки -->
          <app-note-editor [item]="activeContent()" (patch)="activeContentPatch.set($event)"/>
        }
        @case ('maps') {
          <!-- Карты -->
          <app-map-editor [item]="activeContent()" (patch)="activeContentPatch.set($event)"/>
        }
        @case ('chapters') {
          <!-- Главы -->
          <app-chapter-editor [item]="activeContent()" (patch)="activeContentPatch.set($event)"/>
        }
        @case ('npcs'){
          <!-- NPC -->
          <app-npc-editor [item]="activeContent()" (patch)="activeContentPatch.set($event)"/>
        }
        @case ('events'){
          <!-- Timeline -->
          <app-timeline-editor [adventureId]="id()"/>
        }
        @case ('artifacts'){
          <!-- Артефакты -->
          <app-artifact-editor [item]="activeContent()" (patch)="activeContentPatch.set($event)"/>
        }
        @default {
          <!-- Заглушка по умолчанию -->
          <!--<div class="h-full flex items-center justify-center">
            <div class="text-center text-gray-500">
              <i class="pi pi-inbox text-6xl mb-4"></i>
              <h3 class="text-xl font-semibold">Выберите элемент для редактирования</h3>
              <p class="mt-2">Используйте левую панель для навигации по элементам приключения</p>
            </div>
          </div>-->
          <app-adventure-editor [item]="activeContent()" (patch)="activeContentPatch.set($event)"/>
        }
      }
    </div>
  </div>
</div>

<!-- Контекстное меню -->
<p-menu #contextMenu [model]="contextMenuItems" [popup]="true"></p-menu>
