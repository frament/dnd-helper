<div class="flex h-full bg-gray-900">
  <!-- Левая панель навигации -->
  <div class="w-72 bg-gray-800 border-r border-gray-700 flex flex-col">
    <!-- Заголовок редактора -->
    <div class="p-4 border-b border-gray-700">
      <h2 class="text-xl font-bold text-white">Редактор приключения</h2>
      <p class="text-gray-400 text-sm">"{{ adventure.value()?.name }}"</p>
    </div>

    <!-- Навигационное меню -->
    <div class="flex-1 overflow-y-auto p-2">
      <p-accordion [value]="['0']" [multiple]="true">
        <!-- Заметки -->
        <p-accordion-panel value="0">
          <p-accordion-header>Заметки</p-accordion-header>
          <p-accordion-content>
          <div>
            @for (note of notes.value(); track note.id) {
              <div class="flex items-center justify-between py-2 px-3 rounded hover:bg-gray-700 cursor-pointer"
                   [class.bg-blue-900]="activeItem === note.id.id"
                   (click)="selectItem('notes', note.id.id+'')">
                <div class="flex items-center">
                  <i class="pi pi-file text-gray-400 mr-2"></i>
                  <span class="text-gray-300">{{note.title}}</span>
                </div>
                <button pButton
                        class="p-button-text p-button-sm p-button-plain"
                        (click)="openContextMenu($event, note)">
                  <i class="pi pi-ellipsis-v text-gray-400"></i>
                </button>
              </div>
            }
            <button pButton icon="pi pi-plus"
                    label="Добавить заметку"
                    class="p-button-text p-button-sm w-full mt-2"
                    (click)="addItem('notes')"></button>
          </div>
          </p-accordion-content>
        </p-accordion-panel>

        <!-- Карты -->
        <p-accordion-panel value="1">
          <p-accordion-header>Карты</p-accordion-header>
          <p-accordion-content>
          <div class="ml-4">
            @for (map of maps.value(); track map.id){
              <div class="flex items-center justify-between py-2 px-3 rounded hover:bg-gray-700 cursor-pointer"
                   [class.bg-blue-900]="activeItem === map.id.id"
                   (click)="selectItem('maps', map.id.id+'')">
                <div class="flex items-center">
                  <i class="pi pi-map text-gray-400 mr-2"></i>
                  <span class="text-gray-300">{{map.title}}</span>
                </div>
                <button pButton icon="pi pi-ellipsis-v"
                        class="p-button-text p-button-sm p-button-plain"
                        (click)="openContextMenu($event, map)"></button>
              </div>
            }
            <button pButton icon="pi pi-plus"
                    label="Добавить карту"
                    class="p-button-text p-button-sm w-full mt-2"
                    (click)="addItem('maps')"></button>
          </div>
          </p-accordion-content>
        </p-accordion-panel>

        <!-- Главы -->
        <p-accordion-panel value="2">
          <p-accordion-header>Главы</p-accordion-header>
          <p-accordion-content>
          <div class="ml-4">
            @for (chapter of chapters; track chapter.id){
              <div class="flex items-center justify-between py-2 px-3 rounded hover:bg-gray-700 cursor-pointer"
                   [class.bg-blue-900]="activeItem === chapter.id"
                   (click)="selectItem('chapters', chapter.id)">
                <div class="flex items-center">
                  <i class="pi pi-book text-gray-400 mr-2"></i>
                  <span class="text-gray-300">{{chapter.title}}</span>
                </div>
                <button pButton icon="pi pi-ellipsis-v"
                        class="p-button-text p-button-sm p-button-plain"
                        (click)="openContextMenu($event, chapter)"></button>
              </div>
            }
            <button pButton icon="pi pi-plus"
                    label="Добавить главу"
                    class="p-button-text p-button-sm w-full mt-2"
                    (click)="addItem('chapters')"></button>
          </div>
          </p-accordion-content>
        </p-accordion-panel>

        <!-- NPC -->
        <p-accordion-panel value="3">
          <p-accordion-header>NPC</p-accordion-header>
          <p-accordion-content>
          <div class="ml-4">
            @for (npc of npcs; track npc.id){
              <div class="flex items-center justify-between py-2 px-3 rounded hover:bg-gray-700 cursor-pointer"
                   [class.bg-blue-900]="activeItem === npc.id"
                   (click)="selectItem('npcs', npc.id)">
                <div class="flex items-center">
                  <i class="pi pi-user text-gray-400 mr-2"></i>
                  <span class="text-gray-300">{{npc.title}}</span>
                </div>
                <button pButton icon="pi pi-ellipsis-v"
                        class="p-button-text p-button-sm p-button-plain"
                        (click)="openContextMenu($event, npc)"></button>
              </div>
            }
            <button pButton icon="pi pi-plus"
                    label="Добавить NPC"
                    class="p-button-text p-button-sm w-full mt-2"
                    (click)="addItem('npcs')"></button>
          </div>
          </p-accordion-content>
        </p-accordion-panel>

        <!-- Timeline -->
        <p-accordion-panel value="4">
          <p-accordion-header>Timeline</p-accordion-header>
          <p-accordion-content>
          <div class="ml-4">
            @for (event of timelineEvents; track event.id){
              <div class="flex items-center justify-between py-2 px-3 rounded hover:bg-gray-700 cursor-pointer"
                   [class.bg-blue-900]="activeItem === event.id"
                   (click)="selectItem('events', event.id)">
                <div class="flex items-center">
                  <i class="pi pi-history text-gray-400 mr-2"></i>
                  <span class="text-gray-300">{{event.title}}</span>
                </div>
                <button pButton icon="pi pi-ellipsis-v"
                        class="p-button-text p-button-sm p-button-plain"
                        (click)="openContextMenu($event, event)"></button>
              </div>
            }
            <button pButton icon="pi pi-plus"
                    label="Добавить событие"
                    class="p-button-text p-button-sm w-full mt-2"
                    (click)="addItem('events')"></button>
          </div>
          </p-accordion-content>
        </p-accordion-panel>

        <!-- Артефакты -->
        <p-accordion-panel value="5">
          <p-accordion-header>Артефакты</p-accordion-header>
          <p-accordion-content>
          <div class="ml-4">
            @for (artifact of artifacts; track artifact.id){
              <div class="flex items-center justify-between py-2 px-3 rounded hover:bg-gray-700 cursor-pointer"
                   [class.bg-blue-900]="activeItem === artifact.id"
                   (click)="selectItem('artifacts', artifact.id)">
                <div class="flex items-center">
                  <i class="pi pi-star text-gray-400 mr-2"></i>
                  <span class="text-gray-300">{{artifact.title}}</span>
                </div>
                <button pButton icon="pi pi-ellipsis-v"
                        class="p-button-text p-button-sm p-button-plain"
                        (click)="openContextMenu($event, artifact)"></button>
              </div>
            }
            <button pButton icon="pi pi-plus"
                    label="Добавить артефакт"
                    class="p-button-text p-button-sm w-full mt-2"
                    (click)="addItem('artifacts')"></button>
          </div>
          </p-accordion-content>
        </p-accordion-panel>
      </p-accordion>
    </div>

    <!-- Кнопки действий -->
    <div class="p-4 border-t border-gray-700">
      <button pButton class="p-button-success w-full mb-2">
        <i class="pi pi-save" pButtonIcon></i>
        <span pButtonLabel>Сохранить</span>
      </button>
      <button pButton class="p-button-secondary w-full">
        <i class="pi pi-eye" pButtonIcon></i>
        <span pButtonLabel>Предпросмотр</span>
      </button>
    </div>
  </div>

  <!-- Основная рабочая область -->
  <div class="flex-1 flex flex-col overflow-hidden">
    <!-- Заголовок рабочей области -->
    <div class="px-6 py-4 flex items-center justify-between">
      <h2 class="text-xl font-semibold text-white">
        {{activeItemTitle()}}
      </h2>
      <div class="flex space-x-2">
        <button pButton class="p-button-success"
                [disabled]="!activeContentPatch()"
                (click)="applyPatch()">
          <i class="pi pi-save" pButtonIcon></i>
          <span pButtonLabel>Сохранить</span>
        </button>
        <button pButton class="p-button-secondary"
                [disabled]="!activeContentPatch()"
                (click)="cancelPatch()">
          <i class="pi pi-times" pButtonIcon></i>
          <span pButtonLabel>Отменить</span>
        </button>
        <p-divider layout="vertical" />
        <button pButton class="p-button-danger mr-2">
          <i class="pi pi-trash" pButtonIcon></i>
        </button>
      </div>
    </div>

    <!-- Контентная область -->
    <div class="flex-1 overflow-auto px-6 pb-6 bg-gray-900">
      <!-- Динамический контент -->
      @switch (activeType()){
        @case ('notes') {
          <!-- Заметки -->
          <app-note-editor [note]="activeContent()" (patch)="activeContentPatch.set($event)"/>
        }
        @case ('maps') {
          <!-- Карты -->
          <app-map-editor [map]="activeContent()" (patch)="activeContentPatch.set($event)"/>
        }
        @case ('chapters') {
          <!-- Главы -->
          <app-chapter-editor [chapter]="activeContent()"/>
        }
        @case ('npcs'){
          <!-- NPC -->
          <app-npc-editor [npc]="activeContent"/>
        }
        @case ('events'){
          <!-- Timeline -->
          <app-timeline-editor />
        }
        @case ('artifacts'){
          <!-- Артефакты -->
          <app-artifact-editor [artifact]="activeContent()"/>
        }
        @default {
          <!-- Заглушка по умолчанию -->
          <!--<div class="h-full flex items-center justify-center">
            <div class="text-center text-gray-500">
              <i class="pi pi-inbox text-6xl mb-4"></i>
              <h3 class="text-xl font-semibold">Выберите элемент для редактирования</h3>
              <p class="mt-2">Используйте левую панель для навигации по элементам приключения</p>
            </div>
          </div>-->
          <app-adventure-editor [adventure]="activeContent()" (patch)="activeContentPatch.set($event)"/>
        }
      }
    </div>
  </div>
</div>

<!-- Контекстное меню -->
<p-menu #contextMenu [model]="contextMenuItems" [popup]="true"></p-menu>
