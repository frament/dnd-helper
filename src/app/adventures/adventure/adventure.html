<div class="flex h-full bg-gray-900">
  <!-- Левая панель навигации -->
  <div class="w-72 bg-gray-800 border-r border-gray-700 flex flex-col">
    <!-- Заголовок редактора -->
    <div class="p-4 border-b border-gray-700">
      <h2 class="text-xl font-bold text-white">Редактор приключения</h2>
      <p class="text-gray-400 text-sm">"Потерянные земли Амазонии"</p>
    </div>

    <!-- Навигационное меню -->
    <div class="flex-1 overflow-y-auto p-2">
      <p-accordion [value]="['0']" [multiple]="true">
        <!-- Заметки -->
        <p-accordion-panel value="0">
          <p-accordion-header>Заметки</p-accordion-header>
          <p-accordion-content>
          <div class="ml-4">
            @for (note of notes; track note.id){
              <div class="flex items-center justify-between py-2 px-3 rounded hover:bg-gray-700 cursor-pointer"
                   [class.bg-blue-900]="activeItem === note.id"
                   (click)="selectItem('note', note.id)">
                <div class="flex items-center">
                  <i class="pi pi-file text-gray-400 mr-2"></i>
                  <span class="text-gray-300">{{note.title}}</span>
                </div>
                <button pButton icon="pi pi-ellipsis-v"
                        class="p-button-text p-button-sm p-button-plain"
                        (click)="openContextMenu($event, 'note', note)"></button>
              </div>
            }
            <button pButton icon="pi pi-plus"
                    label="Добавить заметку"
                    class="p-button-text p-button-sm w-full mt-2"
                    (click)="addItem('note')"></button>
          </div>
          </p-accordion-content>
        </p-accordion-panel>

        <!-- Карты -->
        <p-accordion-panel value="1">
          <p-accordion-header>Карты</p-accordion-header>
          <p-accordion-content>
          <div class="ml-4">
            @for (map of maps; track map.id){
              <div class="flex items-center justify-between py-2 px-3 rounded hover:bg-gray-700 cursor-pointer"
                   [class.bg-blue-900]="activeItem === map.id"
                   (click)="selectItem('map', map.id)">
                <div class="flex items-center">
                  <i class="pi pi-map text-gray-400 mr-2"></i>
                  <span class="text-gray-300">{{map.title}}</span>
                </div>
                <button pButton icon="pi pi-ellipsis-v"
                        class="p-button-text p-button-sm p-button-plain"
                        (click)="openContextMenu($event, 'map', map)"></button>
              </div>
            }
            <button pButton icon="pi pi-plus"
                    label="Добавить карту"
                    class="p-button-text p-button-sm w-full mt-2"
                    (click)="addItem('map')"></button>
          </div>
          </p-accordion-content>
        </p-accordion-panel>

        <!-- Главы -->
        <p-accordion-panel value="2">
          <p-accordion-header>Главы</p-accordion-header>
          <p-accordion-content>
          <div class="ml-4">
            @for (chapter of chapters; track chapter.id){
              <div class="flex items-center justify-between py-2 px-3 rounded hover:bg-gray-700 cursor-pointer"
                   [class.bg-blue-900]="activeItem === chapter.id"
                   (click)="selectItem('chapter', chapter.id)">
                <div class="flex items-center">
                  <i class="pi pi-book text-gray-400 mr-2"></i>
                  <span class="text-gray-300">{{chapter.title}}</span>
                </div>
                <button pButton icon="pi pi-ellipsis-v"
                        class="p-button-text p-button-sm p-button-plain"
                        (click)="openContextMenu($event, 'chapter', chapter)"></button>
              </div>
            }
            <button pButton icon="pi pi-plus"
                    label="Добавить главу"
                    class="p-button-text p-button-sm w-full mt-2"
                    (click)="addItem('chapter')"></button>
          </div>
          </p-accordion-content>
        </p-accordion-panel>

        <!-- NPC -->
        <p-accordion-panel value="3">
          <p-accordion-header>NPC</p-accordion-header>
          <p-accordion-content>
          <div class="ml-4">
            @for (npc of npcs; track npc.id){
              <div class="flex items-center justify-between py-2 px-3 rounded hover:bg-gray-700 cursor-pointer"
                   [class.bg-blue-900]="activeItem === npc.id"
                   (click)="selectItem('npc', npc.id)">
                <div class="flex items-center">
                  <i class="pi pi-user text-gray-400 mr-2"></i>
                  <span class="text-gray-300">{{npc.title}}</span>
                </div>
                <button pButton icon="pi pi-ellipsis-v"
                        class="p-button-text p-button-sm p-button-plain"
                        (click)="openContextMenu($event, 'npc', npc)"></button>
              </div>
            }
            <button pButton icon="pi pi-plus"
                    label="Добавить NPC"
                    class="p-button-text p-button-sm w-full mt-2"
                    (click)="addItem('npc')"></button>
          </div>
          </p-accordion-content>
        </p-accordion-panel>

        <!-- Timeline -->
        <p-accordion-panel value="4">
          <p-accordion-header>Timeline</p-accordion-header>
          <p-accordion-content>
          <div class="ml-4">
            @for (event of timelineEvents; track event.id){
              <div class="flex items-center justify-between py-2 px-3 rounded hover:bg-gray-700 cursor-pointer"
                   [class.bg-blue-900]="activeItem === event.id"
                   (click)="selectItem('event', event.id)">
                <div class="flex items-center">
                  <i class="pi pi-history text-gray-400 mr-2"></i>
                  <span class="text-gray-300">{{event.title}}</span>
                </div>
                <button pButton icon="pi pi-ellipsis-v"
                        class="p-button-text p-button-sm p-button-plain"
                        (click)="openContextMenu($event, 'event', event)"></button>
              </div>
            }
            <button pButton icon="pi pi-plus"
                    label="Добавить событие"
                    class="p-button-text p-button-sm w-full mt-2"
                    (click)="addItem('event')"></button>
          </div>
          </p-accordion-content>
        </p-accordion-panel>

        <!-- Артефакты -->
        <p-accordion-panel value="5">
          <p-accordion-header>Артефакты</p-accordion-header>
          <p-accordion-content>
          <div class="ml-4">
            @for (artifact of artifacts; track artifact.id){
              <div class="flex items-center justify-between py-2 px-3 rounded hover:bg-gray-700 cursor-pointer"
                   [class.bg-blue-900]="activeItem === artifact.id"
                   (click)="selectItem('artifact', artifact.id)">
                <div class="flex items-center">
                  <i class="pi pi-star text-gray-400 mr-2"></i>
                  <span class="text-gray-300">{{artifact.title}}</span>
                </div>
                <button pButton icon="pi pi-ellipsis-v"
                        class="p-button-text p-button-sm p-button-plain"
                        (click)="openContextMenu($event, 'artifact', artifact)"></button>
              </div>
            }
            <button pButton icon="pi pi-plus"
                    label="Добавить артефакт"
                    class="p-button-text p-button-sm w-full mt-2"
                    (click)="addItem('artifact')"></button>
          </div>
          </p-accordion-content>
        </p-accordion-panel>
      </p-accordion>
    </div>

    <!-- Кнопки действий -->
    <div class="p-4 border-t border-gray-700">
      <button pButton icon="pi pi-save" label="Сохранить"
              class="p-button-success w-full mb-2"></button>
      <button pButton icon="pi pi-eye" label="Предпросмотр"
              class="p-button-secondary w-full"></button>
    </div>
  </div>

  <!-- Основная рабочая область -->
  <div class="flex-1 flex flex-col overflow-hidden">
    <!-- Заголовок рабочей области -->
    <div class="px-6 py-4 flex items-center justify-between">
      <h2 class="text-xl font-semibold text-white">
        {{getActiveItemTitle()}}
      </h2>
      <div>
        <button pButton icon="pi pi-trash"
                class="p-button-danger mr-2"></button>
        <button pButton icon="pi pi-copy"
                class="p-button-secondary"></button>
      </div>
    </div>

    <!-- Контентная область -->
    <div class="flex-1 overflow-auto p-6 bg-gray-900">
      <!-- Динамический контент -->
      @switch (activeType){
        @case ('note') {
          <!-- Заметки -->
          <app-note-editor [content]="activeContent" (save)="console.log($event)"/>
        }
        @case ('map') {
          <!-- Карты -->
          <app-map-editor [map]="activeContent"/>
        }
        @case ('chapter') {
          <!-- Главы -->
          <app-chapter [chapter]="activeContent"/>
        }
        @case ('npc'){
          <!-- NPC -->
          <app-npc-editor [npc]="activeContent"/>
        }
        @case ('event'){
          <!-- Timeline -->
          <app-timeline-editor />
        }
        @case ('artifact'){
          <!-- Артефакты -->
          <app-artifact-editor [artifact]="activeContent"></app-artifact-editor>
        }
        @default {
          <!-- Заглушка по умолчанию -->
          <div class="h-full flex items-center justify-center">
            <div class="text-center text-gray-500">
              <i class="pi pi-inbox text-6xl mb-4"></i>
              <h3 class="text-xl font-semibold">Выберите элемент для редактирования</h3>
              <p class="mt-2">Используйте левую панель для навигации по элементам приключения</p>
            </div>
          </div>
        }
      }
    </div>
  </div>
</div>

<!-- Контекстное меню -->
<p-menu #contextMenu [model]="contextMenuItems" [popup]="true"></p-menu>
